<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USA Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <!-- <link rel="stylesheet" href="leaflet/leaflet.css" /> local file -->
    <style>
        #mapid { height: 500px; }
        #locations { margin-top: 20px; }
        .state-header { font-weight: bold; list-style: none; margin-bottom: 5px; }
        #locations h2 { display: block; }
        #locationList li { margin-bottom: 10px; }
        .location-image { max-width: 100px; max-height: 100px; margin-right: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <p style="margin-bottom: 20px;">Are you looking for a local installer? Have no fears as Miles Works builds are happening all over by the top trained and experienced body shops in North America. By using the interactive map, these body shops are easily searchable to find one nearest you.</p>


    <div id="mapid"></div>

    <div>
        <label for="states">Choose a state or country:</label>
        <select id="states" onchange="filterMarkers()">
            <option value="all">All Locations</option>
            <option value="Canada">Canada</option>
            <option value="Florida">Florida</option>
            <option value="Texas">Texas</option>
            <option value="Washington">Washington</option>
        </select>
    </div>


    <div id="locations">
        <h2>Authorized Garages</h2>
        <ul id="locationList">
            <!-- List items will be dynamically added based on the selected state -->
        </ul>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <!-- <script src="leaflet/leaflet.js"></script> local file -->
    <script>
        var map = L.map('mapid').setView([50.0000, -95.0000], 3); // Centered on North America, zoom level 3

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var markers = [
            {name: "Gizmos PowerFactory", address: "1035 SW 1st Way, Deerfield Beach, FL 33441", state: "Florida", latlng: [26.3073, -80.1098], phone: "(456) 789-0123", website: "https://www.gizmospowerfactory.com/", tier: "Certified and Proven Installer", instagram: "https://www.instagram.com/gizmospowerfactory/", email: "info@gizmospowerfactory.com", images: ["https://cdna.artstation.com/p/assets/images/images/041/110/792/large/mag-works-rod1.jpg?1630785917","https://images5.alphacoders.com/106/1068620.jpg"]},
            {name: "Epitome Auto Design", address: "5219 84th St E Suite B, Tacoma, WA 98446", state: "Washington", latlng: [47.1710, -122.3826], phone: "(567) 890-1234", website: "https://www.epitomeautodesign.com/", tier: "Certified and Proven Installer", instagram: "https://www.instagram.com/epitomeautodesign/", email: "contact@epitomeautodesign.com", images: ["https://example.com/image3.jpg"]},
            {name: "QTX AUTO", address: "2121 Brittmoore Rd Suite 100, Houston, TX 77043", state: "Texas", latlng: [29.8052, -95.5747], phone: "(678) 901-2345", website: "https://www.qtxauto.com/", tier: "Certified and Proven Installer", instagram: "https://www.instagram.com/qtxauto/", email: "info@qtxauto.com", images: ["https://example.com/image4.jpg", "https://example.com/image5.jpg"]},
            {name: "Lee's Autoworks", address: "1295 Thornton Rd S, Oshawa, ON L1J 0E6, Canada", state: "Canada", latlng: [43.8829, -78.8286], phone: "(789) 012-3456", website: "https://www.leesautoworks.com/", tier: "Certified and Proven Installer", instagram: "https://www.instagram.com/leesautoworks/", email: "contact@leesautoworks.com", images: ["https://example.com/image6.jpg", "https://example.com/image7.jpg"]},
            { name: "AutoTech Solutions", address: "123 Main Street, Miami, FL 33101", state: "Florida", latlng: [25.7617, -80.1918], phone: "(987) 654-3210", website: "https://www.autotechsolutions.com/", tier: "Recommended Installer", instagram: "https://www.instagram.com/autotechsolutions/", email: "info@autotechsolutions.com", images: ["https://example.com/image8.jpg", "https://example.com/image9.jpg"] }

            // Add more locations as needed
        ];

        var allMarkers = [];

        markers.forEach(function(markerInfo) {
            var marker = L.marker(markerInfo.latlng).bindPopup
            ("<b>" + markerInfo.address + "</b>");
            marker.name = markerInfo.name; // Add info attribute to marker
            marker.state = markerInfo.state; // Add state attribute to marker
            marker.phone = markerInfo.phone; // Add phone attribute to marker
            marker.website = markerInfo.website; // Add website attribute to marker
            marker.tier = markerInfo.tier; // Add tier attribute to marker
            marker.instagram = markerInfo.instagram; // Add instagram attribute to marker
            marker.email = markerInfo.email; // Add email attribute to marker
            marker.images = markerInfo.images; // Add images attribute to marker
            allMarkers.push(marker);
        });

        function openImageInNewTab(imageUrl) {
            window.open(imageUrl, '_blank');
        }

        function filterMarkers() {
            var selectedState = document.getElementById("states").value;
            var locationList = document.getElementById("locationList");
            locationList.innerHTML = ""; // Clear previous list items

            if (selectedState === "all") {
                map.setView([50.0000, -95.0000], 3); // Zoom out to view entire North America
                var allLocationsHeader = document.createElement("li");
                allLocationsHeader.textContent = "All Locations";
                allLocationsHeader.classList.add("state-header");
                locationList.appendChild(allLocationsHeader);
            } else {
                var stateHeader = document.createElement("li");
                stateHeader.textContent = selectedState;
                stateHeader.classList.add("state-header");
                locationList.appendChild(stateHeader);
            }

            var stateMarkers = allMarkers.filter(function(marker) {
                return marker.state === selectedState || selectedState === "all";
            });

            if (stateMarkers.length > 0) {
                var bounds = L.latLngBounds(stateMarkers.map(function(marker) {
                    return marker.getLatLng();
                }));
                map.fitBounds(bounds);
                stateMarkers.forEach(function(marker) {
                    map.addLayer(marker);
                    var li = document.createElement("li");
                    var imagesHTML = marker.images.map(function(image) {
                        return "<img src='" + image + "' class='location-image' onclick='openImageInNewTab(\"" + image + "\")' />";
                    }).join("");
                    li.innerHTML =
                        "<strong>" + marker.name + "</strong><br>" +
                        "" + marker.getPopup().getContent().replace(/<\/?b>/g, '') + "<br>" +
                        "" + marker.phone + "<br>" +
                        "<em>" + marker.tier + "</em><br>" +
                        "<a href='" + marker.instagram + "'>Instagram</a><br>" +
                        "<a href='mailto:" + marker.email + "'>Email</a><br>" +
                        imagesHTML;
                    locationList.appendChild(li);
                });
            }

            document.getElementById("locations").style.display = "block";
        }

        filterMarkers();
    </script>
</body>
</html>
